<!DOCTYPE HTML>
<html>
<head>
    <title>BLE LED Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial; text-align: center; margin: 20px; }
        .button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        #status {
            margin: 10px;
            padding: 10px;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
<h1>BLE LED Control</h1>
<div id="status">Not Connected</div>
<button class="button" onclick="connect()">Connect</button>
<br><br>
<input type="color" id="colorPicker" onchange="setColor(this.value)" disabled>
<br><br>
<button class="button" onclick="sendCommand('ON')" disabled>ON</button>
<button class="button" onclick="sendCommand('OFF')" disabled>OFF</button>
<button class="button" onclick="sendCommand('BREATH')" disabled>BREATHING</button>

<script>
    let characteristic = null;
    const serviceUuid = "4fafc201-1fb5-459e-8fcc-c5c9c331914b";
    const characteristicUuid = "beb5483e-36e1-4688-b7f5-ea07361b26a8";

    async function connect() {
        try {
            const device = await navigator.bluetooth.requestDevice({
                filters: [{
                    services: [serviceUuid]
                }]
            });

            const server = await device.gatt.connect();
            const service = await server.getPrimaryService(serviceUuid);
            characteristic = await service.getCharacteristic(characteristicUuid);

            document.getElementById('status').textContent = 'Connected!';
            document.querySelectorAll('button:not(:first-child)').forEach(btn => btn.disabled = false);
            document.getElementById('colorPicker').disabled = false;

        } catch(error) {
            console.log('Error:', error);
            document.getElementById('status').textContent = 'Error: ' + error;
        }
    }

    async function sendCommand(command) {
        if (characteristic) {
            const encoder = new TextEncoder();
            await characteristic.writeValue(encoder.encode(command));
        }
    }

    async function setColor(color) {
        if (characteristic) {
            const command = 'COLOR:' + color.substring(1);
            const encoder = new TextEncoder();
            await characteristic.writeValue(encoder.encode(command));
        }
    }
</script>
</body>
</html>